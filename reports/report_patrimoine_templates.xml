<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_fiche_vie_template">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">
                        <style>
                            /* Styles CSS pour le PDF */
                            body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 12px; }
                            h1 { font-size: 24px; text-align: center; margin-bottom: 20px; color: #333; }
                            h2 { font-size: 18px; margin-top: 20px; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; color: #555; }
                            .header-info, .asset-info { margin-bottom: 15px; }
                            .header-info p, .asset-info p { margin: 3px 0; }
                            .table-header { background-color: #f2f2f2; font-weight: bold; padding: 8px; border: 1px solid #ddd; text-align: left; }
                            table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            th { background-color: #f2f2f2; }
                            .text-center { text-align: center; }
                            .image-container { text-align: center; margin-bottom: 20px; }
                            .asset-image { max-width: 200px; max-height: 200px; border: 1px solid #ddd; padding: 5px; }
                        </style>

                        <h1>Fiche de Vie du Matériel: <span t-field="o.name"/></h1>

                        <div class="asset-info">
                            <p><strong>Code:</strong> <span t-field="o.code"/><br/></p>
                            <p><strong>Type:</strong> <span t-field="o.type"/><br/></p>
                            <p>
                                <strong>Catégorie Générale:</strong>
                                <span t-field="o.category_general_name"/>
                                <br/>

                            </p>
                            <p>
                                <strong>Sous-Catégorie Détaillée:</strong>
                                <span t-field="o.category_detailed_name"/>
                                <br/>

                            </p>
                            <p><strong>Date d'acquisition:</strong> <span t-field="o.date_acquisition"/><br/></p>
                            <p><strong>Valeur d'acquisition:</strong> <span t-field="o.valeur_acquisition"/> € <br/></p>
                            <p><strong>État actuel:</strong> <span t-field="o.etat"/><br/></p>
                            <p><strong>Localisation:</strong> <span t-field="o.location_id.name"/><br/></p>
                            <p><strong>Département:</strong> <span t-field="o.department_id.name"/><br/></p>
                            <p><strong>Employé affecté:</strong> <span t-field="o.employee_id.name"/><br/></p>
                            <p><strong>Fournisseur:</strong> <span t-field="o.fournisseur.name"/><br/></p>
                        </div>

                        <div class="image-container" t-if="o.image">
                            <img t-att-src="image_data_url(o.image)" class="asset-image" alt="Image du bien"/>
                        </div>

                        <h2>Historique des Actions et Mouvements</h2>
                        <t t-if="o.fiche_vie_ids">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date de l'action</th>
                                        <th>Type d'action</th>
                                        <th>Description</th>
                                        <th>Utilisateur</th>
                                        <th>Mouvement lié</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="o.fiche_vie_ids.sorted(key=lambda f: f.date, reverse=False)" t-as="line">
                                        <tr>
                                            <td><span t-field="line.date"/></td>
                                            <td><span t-field="line.action"/></td>
                                            <td><span t-field="line.description"/></td>
                                            <td><span t-field="line.utilisateur_id.name"/></td>
                                            <td><span t-field="line.mouvement_id.name"/></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>
                        <t t-else="">
                            <p class="text-center">Aucun historique d'actions disponible pour ce matériel.</p>
                        </t>

                        <t t-if="o.facture_file or o.bon_livraison_file">
                            <h2>Documents Attachés</h2>
                            <p t-if="o.facture_filename">Facture: <span t-field="o.facture_filename"/></p>
                            <p t-if="o.bon_livraison_filename">Bon de Livraison: <span t-field="o.bon_livraison_filename"/></p>
                        </t>

                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>